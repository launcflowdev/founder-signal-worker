# CLAUDE.md

This file provides guidance to Claude Code (claude.ai/code) when working with code in this repository.

## Project Overview

This is a Cloudflare Workers project built with TypeScript. Cloudflare Workers are serverless functions that run on Cloudflare's edge network, handling HTTP requests at global scale.

## Development Commands

### Running Locally
```bash
npm run dev
# or
npm start
```
Both commands start a local development server at http://localhost:8787/ using Wrangler.

### Testing
```bash
npm test
```
Runs tests using Vitest with the Cloudflare Workers test pool (`@cloudflare/vitest-pool-workers`). This allows testing Workers code with proper Cloudflare runtime types and behaviors.

### Deployment
```bash
npm run deploy
```
Deploys the worker to Cloudflare's edge network using Wrangler.

### Type Generation
```bash
npm run cf-typegen
```
Regenerates TypeScript types for the `Env` object based on bindings configured in `wrangler.jsonc`. Run this after adding new bindings (KV stores, D1 databases, R2 buckets, etc.).

## Architecture

### Worker Entry Point
- **src/index.ts**: Main worker file that exports a `fetch` handler satisfying the `ExportedHandler<Env>` interface
- The `fetch` function receives: `request` (Request object), `env` (bindings/environment variables), `ctx` (execution context)

### Configuration
- **wrangler.jsonc**: Wrangler configuration with worker name, entry point, and compatibility date
- Bindings (KV, D1, R2, etc.) are configured here and become available via the `Env` type
- **worker-configuration.d.ts**: Auto-generated TypeScript types for the Cloudflare Workers runtime and `Env` interface (generated by `wrangler types`)

### Testing Setup
- **test/index.spec.ts**: Example tests showing both unit and integration testing patterns
- **vitest.config.mts**: Configures Vitest to use the Cloudflare Workers pool
- Tests can use `cloudflare:test` imports for utilities like `env`, `createExecutionContext`, and `SELF` (for integration-style testing)

### TypeScript Configuration
- Uses strict mode with ES2024 target
- Module resolution set to "Bundler" for Cloudflare Workers compatibility
- Main source excludes `test/` directory, which has its own tsconfig

## Cloudflare Workers Specifics

### Adding Resources
When adding Cloudflare resources (KV, D1, R2, Queues, Durable Objects, etc.):
1. Add the binding configuration to `wrangler.jsonc`
2. Run `npm run cf-typegen` to update types
3. Access the binding via the `env` parameter in the fetch handler

### Context Methods
The `ctx` parameter provides:
- `ctx.waitUntil(promise)`: Extend execution lifetime for async work after response is sent
- `ctx.passThroughOnException()`: Allow request to pass through to origin on uncaught exceptions

### Request Handling
- Workers must respond to all requests (no unhandled requests)
- Use `Response` constructor to create responses
- Access request data via standard `Request` API (url, method, headers, body, etc.)
